# imports
import matplotlib.pyplot as plt
from pymongo import MongoClient

# connecting to Mongo DataBase
client = MongoClient('localhost', 27017, unicode_decode_error_handler='ignore')
data_base = client['billboard']
collection = data_base['songs']


# method to plot the average sentiment of songs against year
def song_sentiment_plotter():
    year_list = []
    avg_sentiment_list = []
    start_year = 1958
    end_year = 2019
    while start_year <= end_year:
        year_list.append(start_year)
        sentiment_sum = 0
        no_of_records = collection.count_documents({'active_year': start_year})
        for x in collection.find({'active_year': start_year}):
            sentiment_sum += x['Sentiment']
        avg_sentiment_list.append(sentiment_sum / no_of_records)
        start_year += 1

    plt.xlabel('Years From 1958 - 2019')
    plt.ylabel('Average Sentiment/Year')
    plt.title('Varying Sentiment Of Songs From 1958 -2019')
    plt.plot(year_list, avg_sentiment_list)
    plt.show()


# method to get the sentiment list for each genre
def genre_sentiment_plotter():
    genre_list = ['rock', 'rap', 'pop', 'country', 'metal', 'edm']
    for genre in genre_list:
        year_list = []
        avg_sentiment_list = []
        start_year = 1958
        end_year = 2019
        while start_year <= end_year:
            year_list.append(start_year)
            sentiment_sum = 0
            no_of_records = collection.count_documents({'active_year': start_year, 'genre': {'$in': [genre]}})
            for x in collection.find({'active_year': start_year, 'genre': {'$in': ['rap']}}):
                sentiment_sum += x['Sentiment']
            if no_of_records == 0:
                avg_sentiment_list.append(0)
            else:
                avg_sentiment_list.append(sentiment_sum / no_of_records)
            start_year += 1
        print(avg_sentiment_list)
        print(year_list)

# year_list=[1958, 1959, 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, 1969, 1970, 1971, 1972, 1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019]
# rock_list=[0.07458176731004745, 0.022039475442253213, 0.09710376119008089, 0.1289578959745921, 0.2216126916967253, 0.017739030847830725, 0.15930776498827204, 0.14033771954992186, 0.11974954181738187, 0.12870011354165928, 0.1808556808473867, 0.12028478391632029, 0.10951778748207647, 0.1292004430569812, 0.09927264190493618, 0.10887170869277789, 0.09603243454807793, 0.10936685361740622, 0.13374312653279966, 0.11930382222366825, 0.13954487477950864, 0.1406179261117232, 0.12661097585711575, 0.09963071719895401, 0.15014744569775962, 0.1385377752577732, 0.11351375012527319, 0.10272128486369095, 0.13442986824812694, 0.1301396685961258, 0.12570696750940677, 0.1376115451761996, 0.13438626331001216, 0.10567464445873258, 0.09814297444240155, 0.1710840578337034, 0.14011412047661065, 0.15690274939597487, 0.21304382077006137, -0.05503383190883191, 0.037922751851323246, 0.16282467532467534, 0.1723221935554525, -0.10166666666666666, 0.19222222222222218, 0.14656249999999998, -0.04126623376623378, -0.10447781385281384, 0.006052910052910025, 0.09081699346405227, -0.04651169092345565, 0.37071428571428566, 0.06984126984126984, 0.2124223602484472, 0.15566036105098607, 0, -0.1343400390459214, 0, 0, 0, 0, 0]
# rap_list=[0, 0, 0, 0, 0, 0, 0.049339489165633486, 0, 0, 0, 0, 0, 0, 0.008641975308641962, 0.33971414828557683, 0.09919833253166586, 0.0, 0.0022640735418246126, -0.1875, 0.020151727357609693, -0.009637188208616823, 0.11327566165209846, 0.03077531803597605, 0.08197105448082011, 0.023951716703808395, 0, 0, 0.20385839689411117, 0.15686205158391855, 0.13119804844062208, 0.08313469427255364, 0.07549816494806147, 0.10416913858008511, 0.1126816138689939, 0.07874949606053014, 0.010934431819481252, 0.06892618014270681, 0.06661407787795681, 0.05461040328533072, 0.03765344614380816, 0.030863338278690953, 0.0014592431561521481, 0.07026804965621343, 0.0493329902724876, 0.07872778449264135, 0.07269453833631517, 0.04120167556239887, 0.05186804307886559, 0.08220747064803689, 0.1302531554407283, 0.04587320985728272, 0.07292778381677596, 0.020875992486991395, 0.04082194214678001, 0.052832094607866885, 0.04568203310195653, 0.04809754969314703, -0.006345649697346454, 0.04675374266820306, 0.03077756650813079, 0.018858113043686852, 0.029631164644355164]
# pop_list=[0, 0, 0, 0, 0, 0, 0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.004320987654320981, 0.10191424448567306, 0.0743987493987494, 0.0, 0.002830091927280766, 0, 0.008060690943043878, -0.009637188208616823, 0.04854671213661362, 0.020516878690650702, 0.08197105448082011, 0.04790343340761679, 0.0, 0.0, 0.05096459922352779, 0.09411723095035114, 0.07156257187670295, 0.08313469427255364, 0.0629151374567179, 0.11218214924009165, 0.1478946182030545, 0.15749899212106028, 0.025695914775780943, 0.21208055428525172, 0.15321237911930066, 0.08401600505435496, 0.05152576840731643, 0.024004818661204075, 0.0006485525138453991, 0.05815286868100422, 0.04567869469674778, 0.0524851896617609, 0.05131379176681071, 0.04267316397534169, 0.0452465907709253, 0.03622702096354168, 0.03627303062906358, 0.008462048420275453, 0.01585386604712521, 0.005711356435120288, 0.013009190354468356, 0.012657689333134775, 0.016150213722913923, 0.005865554840627687, -0.0026340432705966414, 0.03130467987349249, 0.036437808624568635, 0.04208578886578895, 0.025398141123733]
# country =[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.005482165462848165, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0005083514887436448, 0.1455917778366758, 0.024799583132916466, 0.0, 0.0007075229818201915, -0.013392857142857142, 0.003100265747324568, -0.0014826443397872036, 0.019989822644487964, 0.0036206256512913, 0.0035639588904704395, 0.003991952783968066, 0.0, 0.0, 0.20385839689411117, 0.4705861547517557, 0.7871882906437324, 0, 0, 0.7291839700605958, 1.183156945624436, 0.5039967747873929, 0.034261219701041255, 0.14510774766885642, 0.3404719535984459, 0.12135645174517938, 0.06526597331593414, 0.008641734718033468, 0.00024663264611022223, 0.024800488113957683, 0.02202365637164625, 0.037048369173007696, 0.030608226667922178, 0.018965850655707415, 0.029951968538499848, 0.03749814450612209, 0.04548522888406385, 0.014772728598107994, 0.026423110078542016, 0.009764577131012104, 0.01644217114245306, 0.01869443347662982, 0.025788244493039975, 0.010306617791388648, -0.005816845555900917, 0.0900009546362909, 0.07044643000749937, 0.14379311195811226, 0.08421488898921994]
# metal=[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0, 0.0, 0.0, 0.0021604938271604906, 0.16985707414278842, 0.04251357108499965, 0.0, 0.0016171953870175806, -0.01875, 0.004478161635024376, -0.003212396069538941, 0.04247837311953692, 0.006838959563550234, 0.01639421089616402, 0.013686695259319082, 0.0, 0.0, 0.029122628127730168, 0.04278055952288688, 0.06559902422031104, 0.11084625903007153, 0.04194342497114526, 0.13257890364738104, 0.21511944465898836, 0.31499798424212055, 0, 2.757047205708272, 0, 0.5461040328533072, 0.48949479986950606, 0.43208673590167335, 0, 0.8432165958745612, 0, 0, 0, 0, 0, 0, 2.8655694196960226, 0.21789774682209292, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3.451034686994694, 0]
# edm=[0, 0, 0, 0, 0, 0, 0, 0, 0.0, 0, 0, 0, 0, 0, 0, 0, 0, 0.005660183854561532, 0, 0.040303454715219386, 0, 0.3398269849562954, 0.0615506360719521, 0, 0.09580686681523358, 0, 0, 0, 0, 0, 0.4988081656353219, 0.7549816494806147, 0.48612264670706384, 1.183156945624436, 0, 0.17130609850520628, 2.757047205708272, 0, 0, 0.9789895997390121, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9115972977096995, 0.2018012607075835, 0.3946121074188735, 0.1735911679972769, 0.26647852642807973, 0.12024387423286757, -0.279208586683244, 0.6000063642419393, 1.0566964501124905, 1.725517343497347, 0.533360963598393]
#
# plt.xlabel('Average Sentiment/Year')
# plt.ylabel('Years From 1958 - 2019')
# plt.title('Varying Sentiment Of Generic Music Genres From 1958 -2019')
# plt.barh(year_list, rock_list,color='blue',label="Rock")
# plt.barh(year_list, metal,color='black',label="Metal")
# plt.barh(year_list, country,color='green',label="Country")
# plt.barh(year_list, pop_list,color='yellow',label="Pop")
# plt.barh(year_list, rap_list,color='red',label="Rap")
# plt.barh(year_list, edm,color='orange',label="EDM")
#
# plt.show()
